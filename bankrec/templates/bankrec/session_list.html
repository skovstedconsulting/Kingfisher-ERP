{% extends "base.html" %}

{% block content %}
<h1 style="margin:16px;">Bankafstemning – Sessions</h1>

<div style="margin:0 16px 16px 16px; padding:12px; background:#fff; border:1px solid #ddd; border-radius:6px;">
  <form method="get" style="display:flex; gap:12px; align-items:end; flex-wrap:wrap;">
    <div>
      <label style="display:block; font-size:12px; opacity:.8;">Status</label>
      <select name="status">
        <option value="" {% if not status %}selected{% endif %}>Alle</option>
        <option value="open" {% if status == "open" %}selected{% endif %}>Open</option>
        <option value="closed" {% if status == "closed" %}selected{% endif %}>Closed</option>
      </select>
    </div>

    <div>
      <label style="display:block; font-size:12px; opacity:.8;">Entity id</label>
      <input type="text" name="entity" value="{{ entity_id }}" placeholder="fx 1" style="width:120px;">
    </div>

    <button type="submit">Filtrér</button>
    <a href="{% url 'bankrec:session-list' %}" style="margin-left:auto;">Nulstil</a>
  </form>
</div>

<div style="margin:0 16px; background:#fff; border:1px solid #ddd; border-radius:6px; overflow:hidden;">
  <table style="width:100%; border-collapse:collapse; font-size:14px;">
    <thead style="background:#fafafa;">
      <tr>
        <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Session</th>
        <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Entity</th>
        <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Setup</th>
        <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Statement</th>
        <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Status</th>
        <th style="text-align:right; padding:10px; border-bottom:1px solid #eee;">Matches</th>
        <th style="text-align:right; padding:10px; border-bottom:1px solid #eee;">Oprettet</th>
        <th style="text-align:right; padding:10px; border-bottom:1px solid #eee;"></th>
      </tr>
    </thead>
    <tbody>
      {% for s in sessions %}
        <tr>
          <td style="padding:10px; border-bottom:1px solid #eee;">#{{ s.id }}</td>
          <td style="padding:10px; border-bottom:1px solid #eee;">{{ s.entity }}</td>
          <td style="padding:10px; border-bottom:1px solid #eee;">{{ s.setup.name }}</td>
          <td style="padding:10px; border-bottom:1px solid #eee;">{{ s.staging.statement_id }}</td>
          <td style="padding:10px; border-bottom:1px solid #eee;">{{ s.status }}</td>
          <td style="padding:10px; border-bottom:1px solid #eee; text-align:right;">{{ s.match_count }}</td>
          <td style="padding:10px; border-bottom:1px solid #eee; text-align:right;">{{ s.created_at|date:"Y-m-d H:i" }}</td>
          <td style="padding:10px; border-bottom:1px solid #eee; text-align:right;">
            <a href="{% url 'bankrec:reconcile' s.id %}">Åbn</a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="8" style="padding:12px; color:#666;">Ingen sessions.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
